{"version":3,"file":"student_list.min.js","sources":["../src/student_list.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for student reminder list actions.\n *\n * @module     local_mandatoryreminder/student_list\n * @copyright  2026 Your Name\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/notification', 'core/str'],\nfunction($, ModalFactory, ModalEvents, Notification, Str) {\n\n    var ajaxUrl = '';\n    var sesskey = '';\n\n    /**\n     * Initialize the module.\n     * @param {string} ajax Ajax URL\n     * @param {string} key Session key\n     */\n    var init = function(ajax, key) {\n        ajaxUrl = ajax;\n        sesskey = key;\n\n        setupSelectAll();\n        setupPreview();\n        setupSendSingle();\n        setupSendSelected();\n        setupSendAll();\n    };\n\n    /**\n     * Setup select-all checkbox functionality.\n     */\n    var setupSelectAll = function() {\n        // Inject select-all checkbox into header\n        $('#mr-student-table thead tr th:first-child').html(\n            '<input type=\"checkbox\" id=\"cb-select-all\">'\n        );\n\n        $(document).on('change', '#cb-select-all', function() {\n            $('.rowcheckbox').prop('checked', $(this).is(':checked'));\n            updateBulkBar();\n        });\n\n        $(document).on('change', '.rowcheckbox', function() {\n            var total = $('.rowcheckbox').length;\n            var n = $('.rowcheckbox:checked').length;\n            $('#cb-select-all').prop('indeterminate', n > 0 && n < total)\n                               .prop('checked', n === total);\n            updateBulkBar();\n        });\n    };\n\n    /**\n     * Update the bulk action bar visibility.\n     */\n    var updateBulkBar = function() {\n        var n = $('.rowcheckbox:checked').length;\n        if (n > 0) {\n            Str.get_string('send_selected', 'local_mandatoryreminder').done(function(str) {\n                $('#btn-send-selected').show().text(str + ' (' + n + ')');\n            });\n        } else {\n            $('#btn-send-selected').hide();\n        }\n    };\n\n    /**\n     * Setup preview button handler.\n     */\n    var setupPreview = function() {\n        $(document).on('click', '.btn-preview', function(e) {\n            e.preventDefault();\n            var id = $(this).data('id');\n            var btn = $(this);\n            \n            btn.prop('disabled', true);\n            var originalText = btn.text();\n            btn.text('...');\n\n            $.get(ajaxUrl, {action: 'preview', id: id, sesskey: sesskey})\n             .done(function(data) {\n                if (data.success) {\n                    showPreviewModal(data.subject, data.body);\n                } else {\n                    Notification.alert('Error', data.error || 'Preview failed');\n                }\n             })\n             .fail(function() {\n                Notification.alert('Error', 'Network error occurred');\n             })\n             .always(function() {\n                btn.prop('disabled', false).text(originalText);\n             });\n        });\n    };\n\n    /**\n     * Show preview modal with email content.\n     * @param {string} subject Email subject\n     * @param {string} body Email body HTML\n     */\n    var showPreviewModal = function(subject, body) {\n        Str.get_strings([\n            {key: 'preview_email', component: 'local_mandatoryreminder'},\n            {key: 'subject', component: 'local_mandatoryreminder'}\n        ]).done(function(strings) {\n            var modalBody = '<div class=\"preview-content\">' +\n                '<h5>' + strings[1] + ':</h5>' +\n                '<p class=\"alert alert-info\">' + $('<div>').text(subject).html() + '</p>' +\n                '<div class=\"preview-body\">' + body + '</div>' +\n                '</div>';\n\n            ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                title: strings[0],\n                body: modalBody,\n                large: true\n            }).done(function(modal) {\n                modal.show();\n            });\n        });\n    };\n\n    /**\n     * Setup single send button handler.\n     */\n    var setupSendSingle = function() {\n        $(document).on('click', '.btn-send', function(e) {\n            e.preventDefault();\n            var id = $(this).data('id');\n            var btn = $(this);\n            var row = btn.closest('tr');\n            \n            btn.prop('disabled', true);\n            var originalText = btn.text();\n            btn.text('...');\n\n            $.post(ajaxUrl, {action: 'send', id: id, sesskey: sesskey})\n             .done(function(data) {\n                if (data.success) {\n                    // Update status badge\n                    row.find('.status-badge[data-id=\"' + id + '\"]')\n                        .removeClass('badge-secondary badge-warning badge-danger')\n                        .addClass('badge-success')\n                        .text(data.status);\n                    \n                    // Update timesent\n                    row.find('.timesent-cell[data-id=\"' + id + '\"]')\n                        .removeClass('text-muted')\n                        .text(data.timesent_formatted);\n                    \n                    // Remove checkbox and send button\n                    row.find('.rowcheckbox').remove();\n                    btn.remove();\n                    \n                    updateBulkBar();\n                    Notification.addNotification({\n                        message: 'Email sent successfully',\n                        type: 'success'\n                    });\n                } else {\n                    btn.prop('disabled', false).text(originalText);\n                    Notification.alert('Error', data.error || 'Send failed');\n                }\n             })\n             .fail(function() {\n                btn.prop('disabled', false).text(originalText);\n                Notification.alert('Error', 'Network error occurred');\n             });\n        });\n    };\n\n    /**\n     * Setup send selected button handler.\n     */\n    var setupSendSelected = function() {\n        $('#btn-send-selected').on('click', function(e) {\n            e.preventDefault();\n            var ids = $('.rowcheckbox:checked').map(function() {\n                return $(this).val();\n            }).get();\n            \n            if (!ids.length) {\n                return;\n            }\n\n            var btn = $(this);\n            btn.prop('disabled', true);\n\n            $.post(ajaxUrl, {\n                action: 'send_selected',\n                'ids[]': ids,\n                sesskey: sesskey\n            })\n             .done(function(data) {\n                if (data.success) {\n                    Notification.addNotification({\n                        message: data.message,\n                        type: 'success'\n                    });\n                    setTimeout(function() {\n                        window.location.reload();\n                    }, 1500);\n                } else {\n                    btn.prop('disabled', false);\n                    Notification.alert('Error', data.error || 'Send failed');\n                }\n             })\n             .fail(function() {\n                btn.prop('disabled', false);\n                Notification.alert('Error', 'Network error occurred');\n             });\n        });\n    };\n\n    /**\n     * Setup send all pending button handler.\n     */\n    var setupSendAll = function() {\n        $('#btn-send-all').on('click', function(e) {\n            e.preventDefault();\n            var count = $(this).data('count');\n            \n            Str.get_string('confirm_send_all', 'local_mandatoryreminder', count)\n               .done(function(confirmMsg) {\n                   if (!confirm(confirmMsg)) {\n                       return;\n                   }\n\n                   var btn = $('#btn-send-all');\n                   btn.prop('disabled', true);\n\n                   $.post(ajaxUrl, {\n                       action: 'send_all',\n                       sesskey: sesskey\n                   })\n                    .done(function(data) {\n                       if (data.success) {\n                           Notification.addNotification({\n                               message: data.message,\n                               type: 'success'\n                           });\n                           setTimeout(function() {\n                               window.location.reload();\n                           }, 1500);\n                       } else {\n                           btn.prop('disabled', false);\n                           Notification.alert('Error', data.error || 'Send failed');\n                       }\n                    })\n                    .fail(function() {\n                       btn.prop('disabled', false);\n                       Notification.alert('Error', 'Network error occurred');\n                    });\n               });\n        });\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","ModalFactory","ModalEvents","Notification","Str","ajaxUrl","sesskey","setupSelectAll","html","document","on","prop","this","is","updateBulkBar","total","length","n","get_string","done","str","show","text","hide","setupPreview","e","preventDefault","id","data","btn","originalText","get","action","success","showPreviewModal","subject","body","alert","error","fail","always","get_strings","key","component","strings","modalBody","create","type","types","DEFAULT","title","large","modal","setupSendSingle","row","closest","post","find","removeClass","addClass","status","timesent_formatted","remove","addNotification","message","setupSendSelected","ids","map","val","setTimeout","window","location","reload","setupSendAll","count","confirmMsg","confirm","init","ajax"],"mappings":"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"}