/**
 * AMD module for student reminder list actions.
 *
 * @module     local_mandatoryreminder/student_list
 * @copyright  2026 Your Name
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_mandatoryreminder/student_list",["jquery","core/modal_factory","core/modal_events","core/notification","core/str"],(function($,ModalFactory,ModalEvents,Notification,Str){var ajaxUrl="",sesskey="",setupSelectAll=function(){$("#mr-student-table thead tr th:first-child").html('<input type="checkbox" id="cb-select-all">'),$(document).on("change","#cb-select-all",(function(){$(".rowcheckbox").prop("checked",$(this).is(":checked")),updateBulkBar()})),$(document).on("change",".rowcheckbox",(function(){var total=$(".rowcheckbox").length,n=$(".rowcheckbox:checked").length;$("#cb-select-all").prop("indeterminate",n>0&&n<total).prop("checked",n===total),updateBulkBar()}))},updateBulkBar=function(){var n=$(".rowcheckbox:checked").length;n>0?Str.get_string("send_selected","local_mandatoryreminder").done((function(str){$("#btn-send-selected").show().text(str+" ("+n+")")})):$("#btn-send-selected").hide()},setupPreview=function(){$(document).on("click",".btn-preview",(function(e){e.preventDefault();var id=$(this).data("id"),btn=$(this);btn.prop("disabled",!0);var originalText=btn.text();btn.text("..."),$.get(ajaxUrl,{action:"preview",id:id,sesskey:sesskey}).done((function(data){data.success?showPreviewModal(data.subject,data.body):Notification.alert("Error",data.error||"Preview failed")})).fail((function(){Notification.alert("Error","Network error occurred")})).always((function(){btn.prop("disabled",!1).text(originalText)}))}))},showPreviewModal=function(subject,body){Str.get_strings([{key:"preview_email",component:"local_mandatoryreminder"},{key:"subject",component:"local_mandatoryreminder"}]).done((function(strings){var modalBody='<div class="preview-content"><h5>'+strings[1]+':</h5><p class="alert alert-info">'+$("<div>").text(subject).html()+'</p><div class="preview-body">'+body+"</div></div>";ModalFactory.create({type:ModalFactory.types.DEFAULT,title:strings[0],body:modalBody,large:!0}).done((function(modal){modal.show()}))}))},setupSendSingle=function(){$(document).on("click",".btn-send",(function(e){e.preventDefault();var id=$(this).data("id"),btn=$(this),row=btn.closest("tr");btn.prop("disabled",!0);var originalText=btn.text();btn.text("..."),$.post(ajaxUrl,{action:"send",id:id,sesskey:sesskey}).done((function(data){data.success?(row.find('.status-badge[data-id="'+id+'"]').removeClass("badge-secondary badge-warning badge-danger").addClass("badge-success").text(data.status),row.find('.timesent-cell[data-id="'+id+'"]').removeClass("text-muted").text(data.timesent_formatted),row.find(".rowcheckbox").remove(),btn.remove(),updateBulkBar(),Notification.addNotification({message:"Email sent successfully",type:"success"})):(btn.prop("disabled",!1).text(originalText),Notification.alert("Error",data.error||"Send failed"))})).fail((function(){btn.prop("disabled",!1).text(originalText),Notification.alert("Error","Network error occurred")}))}))},setupSendSelected=function(){$("#btn-send-selected").on("click",(function(e){e.preventDefault();var ids=$(".rowcheckbox:checked").map((function(){return $(this).val()})).get();if(ids.length){var btn=$(this);btn.prop("disabled",!0),$.post(ajaxUrl,{action:"send_selected","ids[]":ids,sesskey:sesskey}).done((function(data){data.success?(Notification.addNotification({message:data.message,type:"success"}),setTimeout((function(){window.location.reload()}),1500)):(btn.prop("disabled",!1),Notification.alert("Error",data.error||"Send failed"))})).fail((function(){btn.prop("disabled",!1),Notification.alert("Error","Network error occurred")}))}}))},setupSendAll=function(){$("#btn-send-all").on("click",(function(e){e.preventDefault();var count=$(this).data("count");Str.get_string("confirm_send_all","local_mandatoryreminder",count).done((function(confirmMsg){if(confirm(confirmMsg)){var btn=$("#btn-send-all");btn.prop("disabled",!0),$.post(ajaxUrl,{action:"send_all",sesskey:sesskey}).done((function(data){data.success?(Notification.addNotification({message:data.message,type:"success"}),setTimeout((function(){window.location.reload()}),1500)):(btn.prop("disabled",!1),Notification.alert("Error",data.error||"Send failed"))})).fail((function(){btn.prop("disabled",!1),Notification.alert("Error","Network error occurred")}))}}))}))};return{init:function(ajax,key){ajaxUrl=ajax,sesskey=key,setupSelectAll(),setupPreview(),setupSendSingle(),setupSendSelected(),setupSendAll()}}}));

//# sourceMappingURL=student_list.min.js.map